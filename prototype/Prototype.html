<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IEP Chatbot ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö Login (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á RAG Card)</title>
    <style>
        /* --- General Reset & Body Styles --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* --- Login Styles (‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ) --- */
        #loginPage {
            background-color: #fff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            max-width: 550px;
            width: 90%;
            text-align: left;
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        #loginPage h2 {
            grid-column: 1 / span 2;
            color: #1f4e79;
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.8em;
        }

        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô */
        .auth-info-box {
            grid-column: 1 / span 2;
            background-color: #e6f7ff;
            border-left: 5px solid #5b9bd5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .auth-info-box p {
            font-weight: bold;
            color: #1f4e79;
            margin-top: 0;
        }

        .auth-info-box ul {
            list-style: none;
            padding: 0;
            margin: 10px 0 0 0;
        }

        .auth-info-box li {
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px dotted #a0c4e1;
            font-size: 0.95em;
        }

        .auth-info-box li:last-child {
            border-bottom: none;
        }

        /* ‡∏à‡∏±‡∏î Input ‡πÅ‡∏•‡∏∞ Button ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Grid ‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏î‡∏∏‡∏• */
        .input-group {
            grid-column: 1 / span 2;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        #loginPage label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #444;
        }

        input[type="text"],
        input[type="password"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 5px;
            border-radius: 8px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        #loginButton {
            grid-column: 1 / span 2;
            padding: 15px;
            margin-top: 15px;
            background-color: #5b9bd5;
            color: white;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        #loginButton:hover {
            background-color: #4472c4;
        }

        /* --- Main App Styles --- */
        #mainApp {
            display: none;
            width: 95%;
            max-width: 1400px;
            background-color: #fff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            overflow: hidden;
            margin: 20px;
        }

        .container {
            display: flex;
            min-height: 90vh;
        }

        .panel {
            padding: 30px;
            flex: 1;
        }

        .admin-panel {
            background-color: #e6f7ff;
            border-right: 1px solid #cceeff;
            max-width: 450px;
            /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á Admin Panel ‡πÉ‡∏´‡πâ Card ‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà */
        }

        .user-panel {
            background-color: #ffffff;
            flex: 2;
        }

        h3 {
            border-bottom: 2px solid #5b9bd5;
            padding-bottom: 10px;
            color: #1f4e79;
            margin-top: 0;
            margin-bottom: 20px;
        }

        textarea,
        button {
            width: 95%;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            box-sizing: border-box;
        }

        .chat-box {
            height: 60vh;
            overflow-y: auto;
            padding: 15px;
            border: 1px solid #eee;
            background-color: #ffffff;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 20px;
            max-width: 80%;
            word-wrap: break-word;
            line-height: 1.5;
        }

        .user-msg {
            background-color: #d9e9f9;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .ai-msg {
            background-color: #e2f0d9;
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }

        /* --- RAG Card Styles (‡πÉ‡∏´‡∏°‡πà) --- */
        .rag-data-display {
            /* ‡∏•‡∏ö‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡∏≠‡∏≠‡∏Å */
            padding: 0;
            border: none;
            margin-top: 25px;
            font-size: 0.85em;
            background-color: transparent;
        }

        .rag-data-display>div {
            max-height: 40vh;
            /* ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ RAG */
            overflow-y: auto;
            padding-right: 5px;
        }

        .rag-card {
            background-color: #ffffff;
            border: 1px solid #cceeff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Card */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .rag-card-header {
            font-weight: bold;
            color: #1f4e79;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }

        .rag-card-content {
            white-space: pre-wrap;
            /* ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏õ‡πâ‡∏≠‡∏ô */
        }

        .rag-card-actions {
            margin-top: 15px;
            text-align: right;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }

        /* --- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Card) --- */
        .delete-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 6px 12px;
            /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° */
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: background-color 0.3s;
            width: auto;
        }

        .delete-btn:hover {
            background-color: #d32f2f;
        }

        #logoutButton {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: #f44336;
            width: auto;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 0.9em;
            z-index: 100;
        }
    </style>
</head>

<body>

    <div id="loginPage">
        <h2>üîë ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Chatbot IEP</h2>

        <div class="auth-info-box">
            <p>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Credentials):</p>
            <ul>
                <li>**Admin (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• RAG):** username: <b>admin</b> | password: <b>admin1234</b></li>
                <li>**User (‡∏Ñ‡∏£‡∏π):** username: <b>user</b> | password: <b>1111</b></li>
            </ul>
        </div>

        <div class="input-group">
            <label for="loginUsername">Username:</label>
            <input type="text" id="loginUsername" placeholder="admin ‡∏´‡∏£‡∏∑‡∏≠ user">
        </div>

        <div class="input-group">
            <label for="loginPassword">Password:</label>
            <input type="password" id="loginPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
        </div>

        <button id="loginButton" onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        <p id="loginMessage" style="color: #f44336; margin-top: 5px; text-align: center;"></p>
    </div>

    <div id="mainApp">
        <button id="logoutButton" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        <div class="container">

            <div class="panel admin-panel" id="adminPanel">
                <h3>üõ†Ô∏è Admin: ‡∏õ‡πâ‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ (RAG Data)</h3>
                <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡πâ‡∏≠‡∏ô '‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç' (‡∏≠‡∏≤‡∏Å‡∏≤‡∏£/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£) ‡πÅ‡∏•‡∏∞ '‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô' ‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á</p>

                <label for="keyword">‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Keyword):</label>
                <input type="text" id="keyword" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢‡∏ó‡πà‡∏≤‡∏ó‡∏≤‡∏á, ‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏ï‡∏≤, ‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏°‡∏∑‡∏≠‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠">

                <label for="lessonPlan">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô (IEP/‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°):</label>
                <textarea id="lessonPlan" rows="5"
                    placeholder="‡πÄ‡∏ä‡πà‡∏ô [‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: ‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£] ‡∏ù‡∏∂‡∏Å‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ï‡∏£‡∏†‡∏≤‡∏û 10 ‡∏ô‡∏≤‡∏ó‡∏µ, [‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û] ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£‡∏ï‡∏±‡∏î‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© 5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á"></textarea>

                <button onclick="addRAGData()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• RAG</button>

                <div class="rag-data-display">
                    <p style="font-weight: bold; margin-bottom: 10px;">‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• RAG ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</p>
                    <div id="ragDataList">
                    </div>
                </div>
            </div>

            <div class="panel user-panel" id="chatbotPanel">
                <h3>ü§ñ Chatbot: ‡∏à‡∏±‡∏î‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h3>
                <div id="userInfoDisplay" style="margin-bottom: 20px; font-weight: bold; color: #4472c4;"></div>

                <div class="chat-box" id="chatBox">
                    <div class="message ai-msg">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡πâ‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡πá‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ AI
                        ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏ú‡∏ô IEP ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ñ‡∏£‡∏±‡∏ö</div>
                </div>

                <input type="text" id="userInput"
                    placeholder="‡∏õ‡πâ‡∏≠‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡πá‡∏Å ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏î‡πá‡∏Å‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏ï‡∏≤ ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏ï‡πà‡∏≠‡∏ä‡∏∑‡πà‡∏≠">

                <button onclick="sendMessage()">‚ñ∂Ô∏è ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô</button>
            </div>
        </div>
    </div>

    <script>
        // --- ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• RAG (‡∏à‡∏≥‡∏•‡∏≠‡∏á) ‡πÅ‡∏•‡∏∞ User Auth ---

        // User Authentication (‡∏à‡∏≥‡∏•‡∏≠‡∏á)
        const USERS = {
            'admin': { password: 'admin1234', role: 'admin' },
            'user': { password: '1111', role: 'user' }
        };

        let currentUser = null;

        // ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• RAG (‡∏à‡∏≥‡∏•‡∏≠‡∏á) - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        let ragKnowledgeBase = [
            { keyword: "‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏ï‡∏≤", plan: "[‡πÅ‡∏ú‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏≠‡∏≠‡∏ó‡∏¥‡∏™‡∏ï‡∏¥‡∏Å/ASD]\n‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏ö‡∏ï‡∏≤ 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ/‡∏Ñ‡∏£‡∏±‡πâ‡∏á\n‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: ‡∏ù‡∏∂‡∏Å‡∏™‡∏ö‡∏ï‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•, ‡πÉ‡∏ä‡πâ Social Stories" },
            { keyword: "‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏°‡∏∑‡∏≠‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠", plan: "[‡πÅ‡∏ú‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û]\n‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏≤\n‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: ‡∏õ‡∏±‡πâ‡∏ô‡∏î‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô 15 ‡∏ô‡∏≤‡∏ó‡∏µ, ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£‡∏ï‡∏±‡∏î‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ï‡∏≤‡∏°‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á" },
            { keyword: "‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢‡∏ó‡πà‡∏≤‡∏ó‡∏≤‡∏á", plan: "[‡πÅ‡∏ú‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£/‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£]\n‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏ù‡∏∂‡∏Å‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á 3 ‡∏û‡∏¢‡∏≤‡∏á‡∏Ñ‡πå\n‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: ‡∏ù‡∏∂‡∏Å‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ï‡∏£‡∏†‡∏≤‡∏û (PECS), ‡πÄ‡∏•‡∏µ‡∏¢‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏±‡∏ï‡∏ß‡πå" }
        ];

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Login/Logout ---

        function login() {
            const username = document.getElementById('loginUsername').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value.trim();
            const msg = document.getElementById('loginMessage');

            if (USERS[username] && USERS[username].password === password) {
                currentUser = USERS[username];

                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';

                document.body.style.display = 'block';
                document.body.style.padding = '0';
                document.body.style.minHeight = 'auto';

                initializeApp(currentUser.role);
            } else {
                msg.textContent = '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginPage').style.display = 'grid';
            document.getElementById('loginMessage').textContent = '';
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';

            document.body.style.display = 'flex';
            document.body.style.justifyContent = 'center';
            document.body.style.alignItems = 'center';
            document.body.style.minHeight = '100vh';
        }

        function initializeApp(role) {
            const adminPanel = document.getElementById('adminPanel');
            const chatbotPanel = document.getElementById('chatbotPanel');
            const userInfoDisplay = document.getElementById('userInfoDisplay');

            userInfoDisplay.textContent = `‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏∞: ${role.toUpperCase()}`;

            if (role === 'admin') {
                adminPanel.style.display = 'block';
                chatbotPanel.style.flex = 1;
            } else {
                adminPanel.style.display = 'none';
                chatbotPanel.style.flex = 2;
            }

            displayRAGData();
            document.getElementById('chatBox').innerHTML = '<div class="message ai-msg">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡πâ‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡πá‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ AI ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏ú‡∏ô IEP ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ñ‡∏£‡∏±‡∏ö</div>';
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô RAG Data Display (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏õ‡πá‡∏ô Card) ---

        function displayRAGData() {
            const list = document.getElementById('ragDataList');
            if (list) {
                list.innerHTML = '';
                ragKnowledgeBase.forEach((item, index) => {

                    const card = document.createElement('div');
                    card.className = 'rag-card';

                    // Header (Keyword)
                    const header = document.createElement('div');
                    header.className = 'rag-card-header';
                    header.innerHTML = `[${index + 1}] ‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: <b>${item.keyword}</b>`;
                    card.appendChild(header);

                    // Content (Lesson Plan)
                    const content = document.createElement('div');
                    content.className = 'rag-card-content';
                    content.textContent = item.plan;
                    card.appendChild(content);

                    // Actions (Delete Button)
                    const actions = document.createElement('div');
                    actions.className = 'rag-card-actions';

                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                    deleteBtn.className = 'delete-btn';
                    deleteBtn.onclick = function () { deleteRAGData(index); };
                    actions.appendChild(deleteBtn);

                    card.appendChild(actions);
                    list.appendChild(card);
                });
            }
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• RAG (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô) ---
        function deleteRAGData(index) {
            if (currentUser.role !== 'admin') {
                alert("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• RAG");
                return;
            }

            const keywordToDelete = ragKnowledgeBase[index].keyword;

            // *** ‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö ***
            if (confirm(`‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• RAG ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: "${keywordToDelete}"? ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ`)) {
                ragKnowledgeBase.splice(index, 1);
                alert("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                displayRAGData(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            }
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Admin (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• RAG) ---
        function addRAGData() {
            if (currentUser && currentUser.role !== 'admin') {
                alert("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• RAG");
                return;
            }

            const keyword = document.getElementById('keyword').value.trim();
            const lessonPlan = document.getElementById('lessonPlan').value.trim();

            if (keyword && lessonPlan) {
                ragKnowledgeBase.push({ keyword, plan: lessonPlan });
                alert(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• RAG ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç '${keyword}'`);
                document.getElementById('keyword').value = '';
                document.getElementById('lessonPlan').value = '';
                displayRAGData();
            } else {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô");
            }
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Chatbot Logic (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ---
        function sendMessage() {
            const userInput = document.getElementById('userInput').value.trim();
            if (userInput === "") return;

            appendMessage(userInput, 'user-msg');
            document.getElementById('userInput').value = '';

            setTimeout(() => {
                const aiResponse = generateAIResponse(userInput);
                appendMessage(aiResponse, 'ai-msg');
            }, 1000);
        }

        function appendMessage(text, type) {
            const chatBox = document.getElementById('chatBox');
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${type}`;

            let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
            formattedText = formattedText.replace(/\n/g, '<br>');

            msgDiv.innerHTML = formattedText;
            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function generateAIResponse(input) {
            let matchingPlans = [];
            let inputLower = input.toLowerCase();

            ragKnowledgeBase.forEach(item => {
                if (inputLower.includes(item.keyword.toLowerCase())) {
                    matchingPlans.push({
                        keyword: item.keyword,
                        plan: item.plan
                    });
                }
            });

            if (matchingPlans.length > 0) {
                let response = "ü§ñ **‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÅ‡∏ú‡∏ô IEP (‡∏à‡∏≤‡∏Å RAG System):**\n\n";
                response += "‡πÄ‡∏£‡∏≤‡∏û‡∏ö‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:\n";

                matchingPlans.forEach((match, index) => {
                    // ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡πÅ‡∏ä‡∏ó‡∏î‡πâ‡∏ß‡∏¢
                    const planText = match.plan.replace(/\n/g, '<br>');
                    response += `\n**[üí° ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${index + 1}: ${match.keyword} ]**<br>`;
                    response += `${planText}\n`;
                });

                response += "\n\n**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞:** ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ô‡∏≥‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÑ‡∏õ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÉ‡∏ô IEP ‡∏â‡∏ö‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏á";
                return response;
            } else {
                return "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏õ‡πâ‡∏≠‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ RAG ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö";
            }
        }

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        window.onload = () => {
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginPage').style.display = 'grid';
            document.body.style.display = 'flex';
            document.body.style.justifyContent = 'center';
            document.body.style.alignItems = 'center';
            document.body.style.minHeight = '100vh';
        };
    </script>

</body>

</html>